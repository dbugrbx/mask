local function EscapeString(String) return string.gsub(string.gsub(string.gsub(string.gsub(string.gsub(String, "\\", "\\\\"), "\"", "\\\""), "\n", "\\n"), "\r", "\\r"), "\t", "\\t") end local function IsArray(Table) local Index = 1 for Key in pairs(Table) do if Key ~= Index then return false end Index = Index + 1 end return true end local function ToJavaScriptObjectNotation(Table) local ValueType = type(Table) if ValueType == "nil" then return "null" elseif ValueType == "number" then return tostring(Table) elseif ValueType == "boolean" then return Table and "true" or "false" elseif ValueType == "string" then return "\"" .. EscapeString(Table) .. "\"" elseif ValueType == "table" then if IsArray(Table) then local Items = {} for Index = 1, #Table do Items[Index] = ToJavaScriptObjectNotation(Table[Index]) end return "[" .. table.concat(Items, ",") .. "]" else local Items = {} for Key, Value in pairs(Table) do Items[#Items + 1] = "\"" .. EscapeString(tostring(Key)) .. "\":" .. ToJavaScriptObjectNotation(Value) end return "{" .. table.concat(Items, ",") .. "}" end end end return ToJavaScriptObjectNotation
